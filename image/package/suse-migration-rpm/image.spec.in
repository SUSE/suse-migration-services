# needsrootforbuild

%global MinSLEVersion 12.3

Url:            http://www.suse.com/
Name:           __NAME__
Summary:        Migration Live System
Version:        __VERSION__
Release:        __RELEASE__
Group:          System/Management
License:        SUSE-EULA
Source0:        __SOURCE__
Requires:       __PRODUCT__
Requires:       suse-migration-pre-checks
Provides:       Migration = __VERSION__
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
%ifarch s390x
BuildRequires:  p7zip-full
%endif

%description
This package contains the Migration Live System.

%prep

%build

%install
install -d -m 755 $RPM_BUILD_ROOT/migration-image
install -d -m 755 $RPM_BUILD_ROOT/%{_sbindir}
cp %{SOURCE0} $RPM_BUILD_ROOT/migration-image
cp %{_sbindir}/run_migration $RPM_BUILD_ROOT/%{_sbindir}
%ifarch s390x
# Workaround for s390x grub loopback issues
7z e %{SOURCE0} -o$RPM_BUILD_ROOT/migration-image boot/s390x/loader/linux boot/s390x/loader/initrd
%endif

%post
/usr/bin/suse-migration-pre-checks

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-, root, root)
/migration-image
%{_sbindir}/run_migration

%changelog
